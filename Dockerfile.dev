# Dockerfile para desenvolvimento do Game.Servers
FROM ubuntu:22.04

# Evitar prompts interativos
ENV DEBIAN_FRONTEND=noninteractive

# Instalar dependências básicas
RUN apt-get update && apt-get install -y \
    curl \
    wget \
    unzip \
    git \
    jq \
    python3 \
    python3-pip \
    python3-venv \
    software-properties-common \
    apt-transport-https \
    ca-certificates \
    gnupg \
    lsb-release \
    && rm -rf /var/lib/apt/lists/*

# Instalar Terraform
RUN wget https://releases.hashicorp.com/terraform/1.5.0/terraform_1.5.0_linux_amd64.zip \
    && unzip terraform_1.5.0_linux_amd64.zip \
    && mv terraform /usr/local/bin/ \
    && rm terraform_1.5.0_linux_amd64.zip

# Instalar Ansible
RUN pip3 install ansible==6.0.0 ansible-lint

# Instalar DigitalOcean CLI
RUN wget https://github.com/digitalocean/doctl/releases/download/v1.94.0/doctl-1.94.0-linux-amd64.tar.gz \
    && tar -xzf doctl-1.94.0-linux-amd64.tar.gz \
    && mv doctl /usr/local/bin/ \
    && rm doctl-1.94.0-linux-amd64.tar.gz

# Criar usuário de desenvolvimento
RUN useradd -m -s /bin/bash developer \
    && usermod -aG sudo developer \
    && echo "developer ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers

# Configurar diretório de trabalho
WORKDIR /workspace
RUN chown -R developer:developer /workspace

# Mudar para usuário de desenvolvimento
USER developer

# Configurar ambiente
ENV PATH="/home/developer/.local/bin:${PATH}"
ENV ANSIBLE_HOST_KEY_CHECKING=False
ENV ANSIBLE_STDOUT_CALLBACK=yaml

# Expor porta para desenvolvimento
EXPOSE 8080

# Comando padrão
CMD ["/bin/bash"]
